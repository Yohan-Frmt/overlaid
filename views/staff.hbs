<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Dashboard</title>
</head>

<body id="page-top">
    <div id="wrapper">
      {{>sidebar}}
        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">

            <!-- Main Content -->
            <div id="content">

                <!-- Topbar -->
                <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                  <div class='d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search'>
                    <h2>Staff</h2>
                  </div>
                </nav>
                <!-- End of Topbar -->

                <!-- Begin Page Content -->
                <div class="container-fluid">

                    <div class="row">

                        <!-- Area Chart -->
                      <div class="col-xl-12 col-lg-12">
                        <div class="card shadow mb-0">
                          <!-- Card Header - Dropdown -->
                          <div
                            class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold text-primary">Staffs</h6>
                          </div>
                          <!-- Card Body -->
                          <div class="card-body">
                            <div class="chart-area">
                              <div class="row justify-content-center">
                                <div id='staffs' class="d-flex flex-wrap justify-content-around">
                                  {{#each staffs}}
                                    <div id='{{this.name}}' class="card">
                                      <h5 class="card-header">{{this.name}}</h5>
                                      <div class="card-body">
                                        <h5 class="card-title">{{this.twitter}}</h5>
                                        <p class="card-text">{{this.pronoun}}</p>
                                        <button id='deleteStaff' class="btn btn-primary">DELETE</button>
                                      </div>
                                    </div>
                                  {{/each}}
                                </div>
                              </div>
                              <div class="row justify-content-center">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                  <div class="form-group"><label for="staff">Staff Name</label><input type="text" class="form-control" id="staff" placeholder="Type something"/> </div>
                                </div>
                              </div>
                              <div class="row justify-content-center">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                  <div class="form-group"><label for="twitter">Staff twitter</label><input type="text" class="form-control" id="twitter" placeholder="Type something"/> </div>
                                </div>
                              </div>
                              <div class="row justify-content-center">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                  <label for='pronoun'>Staff pronoun</label>
                                  <select class="form-select" id='pronoun'>
                                    <option selected>Select a pronoun</option>
                                    <option value="1">He/Him</option>
                                    <option value="2">She/Her</option>
                                    <option value="3">They/Them</option>
                                    <option value="4">He/She</option>
                                    <option value="5">Ask</option>
                                  </select>
                                </div>
                              </div>
                              <div class="row justify-content-center">
                                <div class="col-md-6 col-lg-4 col-12">
                                  <button id='addStaff' type='submit'>Submit</button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                <!-- /.container-fluid -->

            </div>
            <!-- End of Main Content -->

            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Copyright &copy;</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->

        </div>
        <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>
    <script>
      document.addEventListener('click', (ev) => {
        ev.preventDefault()
        if (ev.target && ev.target.id === 'deleteStaff') {
          const name = ev.target.parentNode.parentNode.id
          const fd = new FormData()
          fd.append('name', name)
          fd.append('type', 'staff')
          fetch('staff', { method: "DELETE", body: fd })
            .then(data => data.json())
            .then(({ data }) => {
              document.querySelector(`#${data.name}`).remove()
            })
        }
      })
      document.addEventListener('click', (ev) => {
        ev.preventDefault()
        if (ev.target && ev.target.id === 'addStaff') {
          const name = document.querySelector('#staff')
          const twitter = document.querySelector('#twitter')
          const pronoun = document.querySelector('#pronoun')
          const fd = new FormData()
          fd.append('name', name.value)
          fd.append('twitter', twitter.value)
          fd.append('pronoun', pronoun.options[pronoun.selectedIndex].text)
          fd.append('type', 'staff')
          fetch('staff', { method: "POST", body: fd })
            .then(data => data.json())
            .then(({ data }) => {
              const card = document.createElement('div')
              card.id = data.name
              card.classList.add('card')
              const h5 = document.createElement('h5')
              h5.classList.add('card-header')
              h5.id = 'name'
              h5.textContent = data.name
              const body = document.createElement('div')
              body.classList.add('card-body')
              const h52 = document.createElement('h5')
              h52.classList.add('card-title')
              h52.textContent = data.twitter || ''
              const p = document.createElement('p')
              p.classList.add('card-text')
              p.textContent = data.pronoun || ''
              const button = document.createElement('button')
              button.id = 'deleteStaff'
              button.classList.add('btn')
              button.classList.add('btn-primary')
              button.textContent = 'DELETE'

              const fragment = document.createDocumentFragment()
              fragment.appendChild(card)
              card.appendChild(h5)
              card.appendChild(body)
              body.appendChild(h52)
              body.appendChild(p)
              body.appendChild(button)
              document.querySelector('#staffs').appendChild(fragment)
            })
        }
      })
    </script>
</body>
</html>
